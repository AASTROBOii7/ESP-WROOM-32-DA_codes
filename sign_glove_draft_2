#include <Adafruit_MPU6050.h>
#include <Adafruit_Sensor.h>
#include <Wire.h>
#include "BluetoothSerial.h"

BluetoothSerial SerialBT;
Adafruit_MPU6050 mpu;

// GPIO Pins for ESP32
const int thumbPin  = 33;
const int indexPin  = 32;
const int middlePin = 35;
const int ringPin   = 34;
const int pinkyPin  = 39; // SN (Sensor_VN)

void setup() {
  Serial.begin(115200);
  
  // Initialize Bluetooth
  SerialBT.begin("SignLanguageGlove"); 

  // Initialize MPU6050
  if (!mpu.begin()) {
    Serial.println("Failed to find MPU6050 chip. Check wiring!");
    while (1) { delay(10); }
  }
  
  // Fixed library constants
  mpu.setAccelerometerRange(MPU6050_RANGE_8_G);
  mpu.setGyroRange(MPU6050_RANGE_500_DEG);
  mpu.setFilterBandwidth(MPU6050_BAND_21_HZ); // Changed from FILTER to BAND

  Serial.println("Glove & MPU6050 Ready! Pair with 'SignLanguageGlove'");
}

void loop() {
  sensors_event_t a, g, temp;
  mpu.getEvent(&a, &g, &temp);

  // Read Flex Sensors
  // Mapping based on your test values (adjust ranges if needed)
  int thumb  = map(analogRead(thumbPin), 400, 3000, 0, 100); 
  int index  = map(analogRead(indexPin), 2000, 3500, 0, 100);
  int middle = map(analogRead(middlePin), 2000, 3500, 0, 100);
  int ring   = map(analogRead(ringPin), 2200, 3600, 0, 100);
  int pinky  = map(analogRead(pinkyPin), 1800, 3200, 0, 100);

  // Constrain to 0-100
  thumb = constrain(thumb, 0, 100);
  index = constrain(index, 0, 100);
  middle = constrain(middle, 0, 100);
  ring = constrain(ring, 0, 100);
  pinky = constrain(pinky, 0, 100);

  // Threshold logic (True = Finger is Folded)
  bool fT = (thumb > 45); 
  bool fI = (index > 60);
  bool fM = (middle > 65);
  bool fR = (ring > 65);
  bool fP = (pinky > 55);

  // MPU6050 Orientation logic
